<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Word Tiles</title>
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' https://appsforoffice.microsoft.com https://appsforoffice.microsoft.com/lib/1/hosted/;
                 script-src 'self' 'unsafe-inline' https://appsforoffice.microsoft.com;
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' data:;
                 connect-src 'self';
                 frame-ancestors 'self' https://*.office.com https://*.office365.com;">
  <!-- CSP: zalecenia dla Office Add-ins -->
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <link rel="stylesheet" href="styles/inspector.css">

  <style>
    .section { margin-bottom: 12px; }
    .row { display:flex; gap:8px; align-items:center; flex-wrap: wrap; }
    .list { border:1px solid #ddd; border-radius:8px; padding:8px; max-height:180px; overflow:auto; }
    .badge { font-size:11px; padding:2px 6px; border:1px solid #ccc; border-radius:999px; }
    .btn { padding:6px 10px; border:1px solid #ccc; border-radius:6px; background:#fff; cursor:pointer; }
    .btn.primary { border-color:#0b57d0; }
    .input { padding:6px 8px; border:1px solid #ccc; border-radius:6px; }
    .placeholder-item { display:flex; justify-content:space-between; align-items:center; padding:6px 0; border-bottom:1px dashed #eee; }
    .placeholder-item:last-child { border-bottom:0; }
  </style>
</head>
<body>
  <header class="section" style="display:flex;align-items:center;justify-content:space-between;">
  <h3>Word Tiles</h3>
  <button id="refreshPlaceholders" class="btn">Odśwież</button>
</header>


  <!-- PLACEHOLDERS -->
  <section class="section">
    <div class="row">
      <strong>Placeholdery w dokumencie</strong>
      <button id="refreshPlaceholders" class="btn secondary sm">Odśwież</button>
    </div>

    <div id="placeholdersList" class="list" aria-live="polite"></div>

    <details class="section">
      <summary><strong>Dodaj placeholder</strong></summary>
      <div class="row" style="margin-top:8px">
        <input id="phName" class="input" placeholder="nazwa (np. customer_name)" />
        <select id="phType" class="input">
          <option value="text">text</option>
          <option value="block-start">block-start</option>
          <option value="block-end">block-end</option>
        </select>
        <button id="addPlaceholder" class="btn">Dodaj</button>
      </div>
      <div style="font-size:12px;opacity:.7;margin-top:6px">
        Wstawia kontrolkę w miejscu kursora: <code>{{ name }}</code>, <code>{{# name }}</code> lub <code>{{/ name }}</code>
      </div>
    </details>
  </section>

  <!-- DROP-SLOT do wstawiania kafli -->
  <div id="drop-slot" class="drop-slot" aria-label="Drop here to insert">
    Upuść kafel tutaj, aby wstawić w bieżące miejsce kursora w Wordzie
  </div>

  <!-- KAFLE -->
  <section class="section">
    <strong>Kafle</strong>
    <div id="tiles" class="tiles"></div>
  </section>

  <script src="./scripts/taskpane.js" type="module"></script>
  <div style="margin-top:12px;">
  <button id="btn-insert-text" aria-label="Insert Text Tile">Wstaw TextTile</button>
  <button id="btn-insert-table" aria-label="Insert Table Tile">Wstaw TableTile</button>
  <button id="btn-insert-image" aria-label="Insert Image Tile">Wstaw ImageTile</button>
  <button id="btn-insert-cond" aria-label="Insert Condition Tile">Wstaw ConditionTile</button>
</div>

<div id="tiles-inspector" role="region" aria-label="Tiles Inspector"></div>
<div style="margin-top:8px;">
  <button id="btn-validate-tiles">Sprawdź kafelki</button>
</div>

<script type="module">
  import { insertTextTile, insertTableTile, insertImageTile, insertConditionTile } from "./scripts/tiles.js";
  import { validateTiles } from "./scripts/inspector.js";

  document.getElementById("btn-insert-text")?.addEventListener("click", () => insertTextTile({name:"Field"}));
  document.getElementById("btn-insert-table")?.addEventListener("click", () => insertTableTile({name:"Items", columns:["Name","Qty","Price"]}));
  document.getElementById("btn-insert-image")?.addEventListener("click", () => insertImageTile({name:"Logo", options:{fit:"contain",maxW:300,maxH:120}}));
  document.getElementById("btn-insert-cond")?.addEventListener("click", () => insertConditionTile({name:"SectionA", expression:"amount > 0"}));

  // expose validate in global scope for ribbon command if needed
  window.validateTiles = validateTiles;
</script>

</body>
</html>
